[Linux](./Linux.md)

# Контейнеризация

Задача — упаковать приложение и его вспомогательные средства в стандартный переносимы файл

Контейнер — представляет собой изолированную группу процессов, которые ограничены частной корневой файловой системой и пространством имен процессов

- Используемые функции ядра:
  - _Пространства имен_ — изолируют контейнерные процессы с точки зрения нескольких функций операционной системы, включая монтирование файловой системы, управление процессами и сетевое взаимодействие
  - _Контрольные группы_ — ограничивают использование системных ресурсов и определяют приоритетность одних процессов над другими.  
    Не позволяют контейнерам, выходящим из-под контроля, использовать всю память и процессорное время
  - _Функциональные возможности_ — позволяют процессам выполнять определенные чувствительные операции с ядром или системные вызовы. (изменять права собственности на файл)
  - _Режим защищенных вычислений_ — ограничивает доступ к системным вызовам.

**Образ** — шаблон для контейнера

- использует точку монтирования объединенной файловой системы для производительности и переносимости, состоит из 2 слоев
  - слой образа — только для чтения
  - слой контейнера — если изменяет данные образа, копирует их в этот слой и изменяет(_copy-on-write_)
- структура каталога соответствует структуре корня Linux

**Сеть**

Хост — маршрутизатор-прокси (между миром и контейнерами)

Для подключения к контейнеру используют Unix-сокеты или TCP

Сетевой режим хоста — контейнер имеет не ограниченный доступ к сетевому стеку х

### Docker

docker — команда, которая выполняет задачи по управлению системой Docker

dockerd — демон, который выполняет операции с контейнерами и образами

- создает виртуальную сеть
- поддерживает каталог, в котором хранятся контейнеры и образы(`/var/lib/docker`)
- создает контейнеры, настраивая объединенную файловую систему и исполняющие процессы
- создает уровень файловой системы с возможностью записи, отделенный от исходного образа  
  Если уровень fs используется в нескольких образах, нужна только одна копия

![Untitled](./Untitled%204.png)

- Удаленное подключение к dockerd  
  `export DOCKER_HOST=tcp://10.0.0.10:2376`  
  порт 2375 — обычный HTTP  
  порт 2376 — TLS

`sudo systemctl start docker` — Запустить докер  
`sudo systemctl enable docker` — Запускать докер при запуске системы

`docker info` — Отображает сводную информацию о демоне

`docker ps` — Отображает запущенные контейнеры

`docker version` — Информация о версии сервера и клиента

`docker rm` — Удаляет Контейнер

`docker rmi` — Удаляет Образ

`docker images` — Отображает локальные образы

`docker inspect` — Отображает конфигурацию контейнера

`docker logs` — Отображает стандартный вывод из контейнера

`docker exec` — Выполняет команду(запускает процесс) в существуюющем контейнере

- `docker run` [options] image [command] [args] — Запускает новый контейнер  
  `--attach-a` — Attach to STDIN, STDOUT or STDERR  
  `--interactive` `-i` — Оставляет STDIN открытым, даже если он не подключен  
  `--tty` `-t` — Allocate a pseudo-TT  
  `-it` — интерактивная обочка  
  `--detach` `-d` — фоновый режим  
  `--publish` `-p` h:c — прокладывает туннель  
  `--volume` `-v` — Привязать монтируемый том  
  `--volumes-from` — Монтировать тома из указанного контейнера  
  `--workdir` `-w` — запускает команду, выполняемую внутри указанного каталога,  
  `--hostname` `-h` — задать hostname  
  `--name` — задать контейнеру имя

`docker start/stop` — Запускает/Останавливает существующий контейнер

`docker pull/push` — Загружает образы в/из удаленного реестра

`docker top` — Отображает состояние контейнерного процесса

Образ — шаблон для контейнера, включающий файлы, библиотеки, приложения от которых зависит запускаемый процесс одному образу можно назначить несколько тегов
